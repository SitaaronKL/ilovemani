"use client";

import { useCallback, useEffect, useLayoutEffect, useRef, useState } from "react";
import { useRouter } from "next/navigation";

const noMessages = [
  "No",
  "Are you sure?",
  "Really sure?",
  "Think again!",
  "Last chance!",
  "Surely not?",
  "You might regret this!",
  "Give it another thought!",
  "Are you absolutely sure?",
  "This could be a mistake!",
  "Have a heart!",
  "Don't be so cold!",
  "Change of heart?",
  "Wouldn't you reconsider?",
  "Is that your final answer?",
  "You're breaking my heart üíî",
];

export default function GamePage() {
  const router = useRouter();
  const [noCount, setNoCount] = useState(0);
  const [yesButtonSize, setYesButtonSize] = useState(1);
  const [isClient, setIsClient] = useState(false);
  const noBtnRef = useRef<HTMLButtonElement | null>(null);
  const [noPos, setNoPos] = useState<{ x: number; y: number }>({ x: 0, y: 0 });

  useEffect(() => {
    setIsClient(true);
  }, []);

  useLayoutEffect(() => {
    // Put the No button somewhere visible on first paint.
    if (typeof window === "undefined") return;
    const padding = 16;
    const rect = noBtnRef.current?.getBoundingClientRect();
    const w = rect?.width ?? 160;
    const h = rect?.height ?? 64;

    const x = Math.max(padding, Math.min(window.innerWidth - w - padding, window.innerWidth * 0.62));
    const y = Math.max(padding, Math.min(window.innerHeight - h - padding, window.innerHeight * 0.62));
    setNoPos({ x, y });
  }, []);

  const handleYesClick = () => {
    router.push("/success");
  };

  const moveNoButtonOnScreen = useCallback(() => {
    if (typeof window === "undefined") return;
    const padding = 16;
    const rect = noBtnRef.current?.getBoundingClientRect();
    const w = rect?.width ?? 160;
    const h = rect?.height ?? 64;

    const minX = padding;
    const minY = padding;
    const maxX = Math.max(padding, window.innerWidth - w - padding);
    const maxY = Math.max(padding, window.innerHeight - h - padding);

    const x = minX + Math.random() * (maxX - minX);
    const y = minY + Math.random() * (maxY - minY);

    setNoPos({ x, y });
  }, []);

  const handleNoHover = () => {
    moveNoButtonOnScreen();
  };

  const handleNoClick = () => {
    setNoCount((prev) => prev + 1);
    setYesButtonSize((prev) => prev + 0.2);
    moveNoButtonOnScreen();
  };

  const currentNoText = noMessages[noCount % noMessages.length];
  const noScale = Math.max(0.75, 1 - noCount * 0.03);

  return (
    <div className="relative min-h-screen w-full overflow-hidden bg-[#f4e6d6]">
      {/* Paper texture overlay */}
      <div className="paper-texture absolute inset-0 pointer-events-none" />

      {/* Floating hearts background */}
      <div className="absolute inset-0 pointer-events-none overflow-hidden">
        {isClient && [...Array(15)].map((_, i) => (
          <div
            key={i}
            className="absolute text-[#b63338] opacity-10 animate-float"
            style={{
              left: `${Math.random() * 100}%`,
              top: `${Math.random() * 100}%`,
              fontSize: `${Math.random() * 40 + 20}px`,
              animationDelay: `${Math.random() * 3}s`,
              animationDuration: `${Math.random() * 2 + 3}s`,
            }}
          >
            ‚ô•
          </div>
        ))}
      </div>

      {/* Main content */}
      <div className="relative z-10 flex flex-col items-center justify-center min-h-screen px-4">
        {/* Question */}
        <h1
          className="font-[var(--font-alex-brush)] text-[#b63338] text-5xl sm:text-6xl md:text-7xl lg:text-8xl text-center mb-16 leading-tight"
          style={{
            textShadow: "0px 4px 6px rgba(123, 30, 28, 0.25)",
          }}
        >
          Will you be my
          <br />
          Valentine?
        </h1>

        {/* Buttons container */}
        <div className="flex flex-col sm:flex-row gap-8 items-center justify-center min-h-[200px]">
          {/* Yes Button - grows with each no */}
          <button
            onClick={handleYesClick}
            className="btn-yes px-8 py-4 bg-[#b63338] text-white font-[var(--font-alex-brush)] rounded-full shadow-lg hover:bg-[#9a2a2e] transition-all duration-300"
            style={{
              fontSize: `${1.5 + yesButtonSize * 0.3}rem`,
              transform: `scale(${yesButtonSize})`,
              textShadow: "0px 2px 4px rgba(0, 0, 0, 0.3)",
            }}
          >
            <span className="inline-flex items-center gap-3">
              <span>Yes!</span>
              <svg
                aria-hidden="true"
                focusable="false"
                className="h-[1.15em] w-[1.15em] drop-shadow-[0px_2px_4px_rgba(0,0,0,0.25)]"
                viewBox="0 0 1000 1000"
                fill="none"
                xmlns="http://www.w3.org/2000/svg"
              >
                <path
                  d="M518.75 912.188C741.908 912.188 922.812 731.283 922.812 508.125C922.812 284.967 741.908 104.062 518.75 104.062C295.592 104.062 114.688 284.967 114.688 508.125C114.688 731.283 295.592 912.188 518.75 912.188Z"
                  fill="white"
                />
                <path
                  d="M229.375 554.062L124.687 577.187L63.4375 630.313L71.5625 682.188L146.25 700.313L162.812 753.438L208.125 756.562L250.625 732.188L306.25 744.063L338.75 723.438L308.75 671.563L260 601.563L229.375 554.062Z"
                  fill="white"
                />
                <path
                  d="M698.125 313.125L737.5 376.875L778.75 452.5L833.125 441.875L840.312 398.75L917.5 375L903.437 298.75L940.312 228.125L895.312 192.5L809.062 205.625L698.125 313.125Z"
                  fill="white"
                />
                <path
                  d="M212.5 517.5L265.938 612.813L397.812 797.5L465.625 791.875L739.375 625.938L816.562 557.5L795.625 463.438L764.688 429.688L692.5 298.438L645.625 218.75L553.75 239.375L369.063 331.25L231.25 410L200.938 464.375L212.5 517.5Z"
                  fill="#FFBBBC"
                />
                <path
                  d="M145.938 455.312C154.375 455.312 157.813 430 160.625 424.062C171.091 401.118 188.904 382.315 211.25 370.625C216.563 367.5 237.188 359.375 220.938 352.187C213.75 348.75 195 362.5 189.688 366.25C166.668 382.723 149.921 406.521 142.188 433.75C140.625 440 134.688 455.937 145.938 455.312Z"
                  fill="#FFBBBC"
                />
                <path
                  d="M141.25 347.187C145 343.125 189.688 320 159.063 324.375C142.564 330.093 128.401 341.073 118.75 355.625C118.75 355.625 95.9375 392.5 112.188 386.875C122.188 383.75 132.5 352.812 141.25 347.187Z"
                  fill="#FFBBBC"
                />
                <path
                  d="M883.125 510C872.187 510 877.5 543.438 876.25 552.188C872.818 570.481 865.345 587.777 854.375 602.813C850.625 608.438 827.5 627.813 834.375 634.063C841.25 640.313 861.562 614.688 862.812 612.813C870.58 601.476 877.077 589.319 882.187 576.563C886.875 566.875 899.687 510 883.125 510Z"
                  fill="#FFBBBC"
                />
                <path
                  d="M912.187 586.25C909.252 597.538 904.158 608.15 897.187 617.5C893.75 622.5 878.125 637.188 878.437 642.5C880 662.813 907.5 620.625 909.687 615C917.5 601.563 933.437 563.438 920 549.688C906.562 535.938 913.437 581.875 912.187 586.25Z"
                  fill="#FFBBBC"
                />
                <path
                  d="M949.688 218.75C934.062 177.812 879.062 168.437 839.375 178.437C788.332 190.416 743.69 221.219 714.375 264.687C705.058 242.202 689.699 222.733 670 208.437C657.479 203.115 643.949 200.581 630.35 201.013C616.751 201.445 603.409 204.831 591.25 210.937C530.438 234.396 471.336 262.067 414.375 293.75C354.375 327.187 282.188 351.562 229.375 395.625C217.241 403.558 206.815 413.838 198.712 425.859C190.608 437.881 184.99 451.401 182.188 465.625C181.03 491.659 187.667 517.447 201.25 539.687C147.5 546.562 81.25 562.812 53.125 613.75C45.8141 625.538 42.3686 639.316 43.2702 653.158C44.1717 667 49.3751 680.214 58.1533 690.955C66.9315 701.695 78.8459 709.425 92.2314 713.064C105.617 716.702 119.805 716.068 132.812 711.25C131.069 718.898 131.021 726.835 132.672 734.503C134.322 742.171 137.631 749.386 142.366 755.639C147.101 761.893 153.147 767.035 160.081 770.703C167.014 774.372 174.666 776.478 182.5 776.875C194.585 778.267 206.819 776.29 217.85 771.16C228.88 766.031 238.277 757.951 245 747.812C249.56 752.941 255.138 757.062 261.38 759.914C267.621 762.765 274.389 764.285 281.25 764.375C296.875 765.937 306.562 757.812 320.312 755.937C334.062 754.062 326.875 753.437 335 764.062C343.125 774.687 346.875 782.812 352.5 789.375C389.375 836.562 453.75 814.062 498.75 793.125C551.435 767.536 601.919 737.643 649.688 703.75C692.5 674.687 737.188 648.437 779.375 618.437C806.317 604.079 826.85 580.086 836.875 551.25C840.344 521.217 833.75 490.882 818.125 465C830.159 461.948 840.837 454.979 848.475 445.191C856.113 435.404 860.277 423.353 860.313 410.937C875.288 413.218 890.603 411.024 904.336 404.631C918.069 398.237 929.606 387.929 937.5 375C943.939 363.419 945.873 349.869 942.931 336.949C939.99 324.029 932.38 312.652 921.562 305C934.075 298.957 944.216 288.917 950.385 276.467C956.553 264.016 958.397 249.865 955.625 236.25C954.843 230.077 952.824 224.124 949.688 218.75ZM650 254.687C656.025 260.326 661.278 266.736 665.625 273.75C679.688 294.062 691.875 315 704.688 336.25C730.938 380 755.312 425 778.438 470.625C786.034 485.359 791.706 501.008 795.313 517.187C759.832 508.258 723.823 501.578 687.5 497.187C673.75 495.312 648.75 494.375 641.25 492.5C621.168 489.638 600.91 488.176 580.625 488.125C584.464 472.554 586.766 456.645 587.5 440.625C589.734 418.399 597.117 397 609.062 378.125C627.784 338.84 641.535 297.374 650 254.687ZM243.75 435.312C275 414.375 308.125 397.187 340.312 378.75C369.08 360.968 398.93 344.999 429.687 330.937C468.947 314.406 506.872 294.869 543.125 272.5C639.687 214.062 639.062 245.312 639.375 253.437C637.47 270.005 632.601 286.094 625 300.937C612.494 336.915 597.779 372.086 580.938 406.25C575.643 398.403 567.555 392.87 558.323 390.78C549.09 388.69 539.408 390.199 531.25 395C519.441 403.818 510.004 415.428 503.787 428.791C497.569 442.153 494.765 456.849 495.625 471.562C485.271 461.754 472.429 454.966 458.492 451.937C444.555 448.907 430.054 449.75 416.562 454.375C410.78 456.118 405.421 459.038 400.823 462.954C396.225 466.869 392.487 471.694 389.845 477.125C387.203 482.556 385.714 488.474 385.472 494.509C385.23 500.543 386.239 506.562 388.438 512.187C346.024 508.342 304.129 500.068 263.438 487.5C254.375 484.687 222.188 477.187 218.75 468.75C215.312 460.312 235.312 440.937 243.125 435.312H243.75ZM296.875 724.687C291.557 726.328 285.914 726.616 280.458 725.525C275.001 724.433 269.902 721.997 265.625 718.437C256.562 710 261.25 701.25 255.937 693.125C250.625 685 249.688 684.375 243.125 693.125C236.562 701.875 234.687 715.625 223.75 724.375C205.937 740.625 159.062 749.375 165 712.812C166.154 705.269 168.585 697.977 172.188 691.25C175.625 684.687 187.188 675.937 188.438 668.75C192.188 648.75 170.937 664.375 161.562 668.75C150.941 674.795 139.186 678.582 127.033 679.873C114.88 681.163 102.592 679.93 90.9375 676.25C87.0387 673.409 83.7462 669.819 81.2528 665.689C78.7594 661.56 77.1152 656.974 76.4167 652.201C75.7182 647.428 75.9794 642.564 77.185 637.893C78.3905 633.222 80.5162 628.839 83.4375 625C110 591.25 166.562 577.812 206.25 570.937C213.016 569.405 219.938 568.67 226.875 568.75C237.5 570.937 235.625 572.812 240.938 584.062C249.887 604.291 260.333 623.824 272.188 642.5C283.125 658.75 295 673.75 306.562 690C310.625 695.937 315.625 699.687 314.687 706.875C313.75 714.062 303.75 721.25 296.875 724.687ZM390.625 769.687C372.976 752.036 357.261 732.551 343.75 711.562C324.687 684.687 305 658.437 286.25 631.562C260.312 593.75 220.625 531.25 218.75 481.875C256.517 503.828 298.667 517.167 342.187 520.937L359.375 524.062H373.437C386.006 523.86 398.405 526.987 409.375 533.125C421.25 539.687 465.312 560.625 465.937 560.625C434.693 621.721 410.576 686.207 394.062 752.812C392.187 759.062 390.625 764.375 389.375 769.687H390.625ZM796.875 532.5C796.875 582.812 717.188 617.187 682.188 641.875C618.429 689.18 550.309 730.303 478.75 764.687C464.687 770.625 412.812 793.437 399.062 775.937C401.67 759.598 406.288 743.643 412.812 728.437C418.437 710.625 425 692.812 431.562 675.312C438.125 657.812 445.938 638.125 453.75 619.687C459.375 606.875 466.562 576.562 477.5 568.437C488.437 560.312 524.375 577.187 543.125 574.687C561.875 572.187 563.125 556.25 567.812 539.375L573.438 517.5C577.5 501.25 579.375 502.187 596.875 502.812C614.375 503.437 799.688 517.812 796.875 531.25V532.812V532.5ZM849.062 313.75C855 318.437 871.25 316.25 880.312 319.687C886.718 322.385 892.239 326.824 896.25 332.5C918.125 365.937 869.375 384.062 844.062 381.562C836.25 381.562 817.5 369.375 812.812 381.562C808.125 393.75 819.375 395 821.875 402.5C822.534 407.362 822.04 412.311 820.431 416.946C818.822 421.582 816.144 425.773 812.615 429.181C809.085 432.589 804.802 435.118 800.113 436.563C795.424 438.009 790.461 438.329 785.625 437.5C765.938 433.125 750.625 384.687 740.312 367.187C735.625 359.062 715 335.937 715.625 325.937C716.25 315.937 732.812 302.812 736.25 298.75C754.259 274.534 775.259 252.694 798.75 233.75C822.5 215.937 870.938 194.375 900.625 211.25C938.75 232.5 900.625 277.5 876.875 289.062C870.625 292.5 831.25 299.375 848.438 312.5L849.062 313.75Z"
                  fill="#361041"
                />
                <path
                  d="M533.75 548.438C533.75 548.438 400 522.5 416.25 487.813C432.5 453.125 515.625 508.125 515.625 508.125C515.625 508.125 515.625 414.375 546.875 418.125C578.125 421.875 533.75 548.438 533.75 548.438Z"
                  fill="#F41870"
                />
              </svg>
            </span>
          </button>
        </div>

        {/* Hint message after several attempts */}
        {noCount >= 5 && (
          <p
            className="mt-8 font-[var(--font-alex-brush)] text-[#b63338] text-xl sm:text-2xl text-center opacity-70"
            style={{ textShadow: "0px 2px 4px rgba(123, 30, 28, 0.2)" }}
          >
            {noCount >= 10
              ? "The answer is clearly Yes... üíù"
              : "I think you know what to do... üíï"}
          </p>
        )}

      </div>

      {/* No Button - infinite + always on-screen */}
      <button
        ref={noBtnRef}
        onClick={handleNoClick}
        onMouseEnter={handleNoHover}
        onTouchStart={handleNoHover}
        className="btn-no fixed z-20 px-8 py-4 bg-gray-400 text-white font-[var(--font-alex-brush)] text-2xl rounded-full shadow-lg transition-all duration-200 select-none"
        style={{
          left: noPos.x,
          top: noPos.y,
          transform: `scale(${noScale})`,
          textShadow: "0px 2px 4px rgba(0, 0, 0, 0.3)",
        }}
      >
        {currentNoText}
      </button>
    </div>
  );
}
